<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸŽ® Multiplayer Tic-Tac-Toe</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ® Multiplayer Tic-Tac-Toe</h1>
        <div id="gameArea">
            <div id="createJoin">
                <button id="createBtn">Create Game</button>
                <input type="text" id="gameIdInput" placeholder="Enter Game ID">
                <button id="joinBtn">Join Game</button>
            </div>
            <div id="gameInfo" style="display:none;">
                <p>Game ID: <span id="gameIdDisplay"></span></p>
                <p>Current Turn: <span id="currentTurnDisplay"></span></p>
                <div id="board">
                    <div class="cell" data-index="0"></div>
                    <div class="cell" data-index="1"></div>
                    <div class="cell" data-index="2"></div>
                    <div class="cell" data-index="3"></div>
                    <div class="cell" data-index="4"></div>
                    <div class="cell" data-index="5"></div>
                    <div class="cell" data-index="6"></div>
                    <div class="cell" data-index="7"></div>
                    <div class="cell" data-index="8"></div>
                </div>
                <div id="result"></div>
                <button id="restartBtn" style="display:none;">Restart Game</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();

        const createBtn = document.getElementById('createBtn');
        const joinBtn = document.getElementById('joinBtn');
        const gameIdInput = document.getElementById('gameIdInput');
        const gameIdDisplay = document.getElementById('gameIdDisplay');
        const currentTurnDisplay = document.getElementById('currentTurnDisplay');
        const gameInfo = document.getElementById('gameInfo');
        const board = document.getElementById('board');
        const result = document.getElementById('result');
        const restartBtn = document.getElementById('restartBtn');

        let currentGameId = '';
        let myTurn = false;

        createBtn.onclick = () => {
            socket.emit('create_game');
        };

        joinBtn.onclick = () => {
            const gameId = gameIdInput.value.trim();
            if (gameId) {
                socket.emit('join_game', {'game_id': gameId});
            }
        };

        socket.on('game_created', (data) => {
            currentGameId = data.game_id;
            gameIdDisplay.textContent = currentGameId;
            currentTurnDisplay.textContent = 'X';
            gameInfo.style.display = 'block';
            document.getElementById('createJoin').style.display = 'none';
            myTurn = true;
        });

        socket.on('game_joined', (data) => {
            currentGameId = data.game_id;
            gameIdDisplay.textContent = currentGameId;
            currentTurnDisplay.textContent = data.current_turn;
            gameInfo.style.display = 'block';
            document.getElementById('createJoin').style.display = 'none';
            myTurn = false;
        });

        socket.on('player_joined', (data) => {
            alert(data.msg);
        });

        socket.on('update_board', (data) => {
            const boardData = data.board;
            board.querySelectorAll('.cell').forEach((cell, index) => {
                cell.textContent = boardData[index];
            });
            currentTurnDisplay.textContent = data.current_turn;
            myTurn = data.current_turn === 'X' && socket.id === games[currentGameId]['players'][0] ||
                      data.current_turn === 'O' && socket.id === games[currentGameId]['players'][1];
        });

        socket.on('update_turn', (data) => {
            currentTurnDisplay.textContent = data.current_turn;
            myTurn = data.current_turn === 'X' && socket.id === games[currentGameId]['players'][0] ||
                      data.current_turn === 'O' && socket.id === games[currentGameId]['players'][1];
        });

        socket.on('game_over', (data) => {
            if (data.winner === 'Draw') {
                result.textContent = "It's a Draw!";
            } else {
                result.textContent = `Player ${data.winner} Wins!`;
            }
            restartBtn.style.display = 'block';
        });

        socket.on('error', (data) => {
            alert(data.msg);
        });

        board.querySelectorAll('.cell').forEach(cell => {
            cell.onclick = () => {
                if (!myTurn || cell.textContent !== '' || result.textContent !== "") {
                    return;
                }
                const index = cell.getAttribute('data-index');
                socket.emit('make_move', {'game_id': currentGameId, 'position': parseInt(index)});
            };
        });

        restartBtn.onclick = () => {
            location.reload();
        };
    </script>
</body>
</html>
